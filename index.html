<head>
    <meta charset="utf-8">
    <title>TP Twitter</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">

    <link rel="stylesheet" href="/themes/bootstrap.min.css">
    <link rel="stylesheet" href="/themes/bootstrap.css">

    <script src="/bower_components/jquery/dist/jquery.min.js"></script>
    <script src="/bower_components/jquery-ui/jquery-ui.js"></script>
    <script src="/bower_components/jquery.cookie/jquery.cookie.js"></script>
    
    <title>TP Twitter</title>
    <style>
        a {text-decoration: none; color: black;}
    </style>
</head>

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid">

        <div class="navbar-header">

            <a class="navbar-brand" href="#">
                <!--<span class="glyphicon glyphicon glyphicon-tree-deciduous"></span>-->
                TP Twitter
            </a>
        </div>

        <ul class="nav navbar-nav">
            <li><a href="/">Home</a></li>
            <li><a href="/about">About</a></li>
        </ul>
        <form class="navbar-form navbar-left" role="search">

            <div class="form-group" id="searchBar">
            </div>
           
        </form>


    </div>
</nav>

<script>
    username = '';
    userid = '';
    cookieuuid = '';
    
    //fonction initialisant l'autocomplétion
    function initAutocompleteBar(){
        $('#searchBar').append('<input id="userSearch" class="form-control" type="text" placeholder="Search User"> <button class="btn btn-default" type="submit">Follow</button>');
        $.ajax({
            url : 'http://localhost:8000/tptwitter/users/',
            dataType : 'json',
            type : 'GET',
            success : function(result) {
                var names = Object.keys(result);
                $('#userSearch').autocomplete({
                    source : names,
                    select: function(event, ui){
                        var name = ui.item.value;
                        $.ajax({
                           url : 'http://localhost:8000/tptwitter/followings',
                           dataType : 'json',
                           type : 'POST',
                           data : "userid=" + userid + "&followid=" + result[ui.item.value]+ "&cookieuuid=" + cookieuuid,
                           success : function (response){
                                if(response.result){
                                    alert('You follow ' +  name);
                                }else{
                                    alert('Failed to follow ' + name);
                                }
                            }
                        });
                    }
                });
            }
        });
    }
//verifie les cookies au démarrage
    $(function(){
        cookieuuid = $.cookie('cookieuuid');
        username = $.cookie('username');
        userid = $.cookie('userid');
         $.ajax({
           url : 'http://localhost:8000/tptwitter/checkcookie',
           dataType : 'json',
           type : 'POST',
           data : "userid=" + userid + "&cookieuuid=" + cookieuuid,
           success : function (response){
                if(response.result){
                    initAutocompleteBar();
                    $('#body').load('/views/home.html');
                }else{
                    username = '';
                    userid = '';
                    cookieuuid = '';
                    $('#body').load('/views/login.html');
                }
           }
       });
    });
</script>
<div id="body">

</div>